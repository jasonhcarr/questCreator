!function(){"use strict";angular.module("questCreator",["ui.router","LocalStorageModule"]).config(function(a,b){b.otherwise("/"),a.state("main",{abstract:!0,url:"/",templateUrl:"./src/views/main.html",controller:"mainCtrl as main"}).state("main.landing",{url:"",templateUrl:"./src/views/landing.html",controller:"landingCtrl as landing"}).state("main.game",{url:"game/",templateUrl:"./src/views/game.html",controller:"gameCtrl as game"}).state("main.game.play",{url:"play/",templateUrl:"./src/views/game/play.html",controller:"playCtrl as play"}).state("main.game.editor",{url:"editor/",templateUrl:"./src/views/game/editor.html",controller:"editorCtrl as editor"}).state("main.game.editor.map",{url:"map/",templateUrl:"./src/views/game/editor/map.html",controller:"mapCtrl as map"}).state("main.game.editor.scene",{url:"scene/",templateUrl:"./src/views/game/editor/scene.html",controller:"sceneCtrl as scene"}).state("main.game.editor.bg",{url:"bg/",templateUrl:"./src/views/game/editor/bg.html",controller:"bgCtrl as bg"}).state("main.game.editor.obj",{url:"obj/",templateUrl:"./src/views/game/editor/obj.html",controller:"objCtrl as obj"}).state("main.game.editor.ent",{url:"ent/",templateUrl:"./src/views/game/editor/ent.html",controller:"entCtrl as ent"}).state("main.game.editor.scripts",{url:"scripts/",templateUrl:"./src/views/game/editor/scripts.html",controller:"scriptsCtrl as scripts"}).state("main.profile",{url:"profile/",templateUrl:"./src/views/profile.html",controller:"profileCtrl as profile"})})}(),angular.module("questCreator").service("socket",function(){var a=io();return{on:function(b,c){a.on(b,c)},emit:function(b,c){a.emit(b,c)},off:function(b,c){a.off(b,c)}}}),angular.module("questCreator").controller("chatCtrl",function(a,b){$("form").submit(function(){return console.log("Submitted!"),a.emit("chat message",$("#m").val()),$("#m").val(""),!1}),a.off("chat message"),a.on("chat message",function(a){$("#messages").append($("<li>").text(a))})}),angular.module("questCreator").controller("gameCtrl",function(a,b,c){}),angular.module("questCreator").controller("landingCtrl",function(a){}),angular.module("questCreator").controller("mainCtrl",function(a,b,c){function d(){gapi.client.setApiKey(m),gapi.auth2.init({client_id:n,scope:"profile"}).then(function(){i=gapi.auth2.getAuthInstance(),console.log("Session authorized"),i.isSignedIn.listen(e),e(i.isSignedIn.get())})}function e(a){a?($("#login").hide(),$("#logout").show(),console.log("Signed In!"),h()):($("#login").show(),$("#logout").hide(),console.log("Signed Out!"))}function f(){i.signIn({prompt:"login"})}function g(){i.signOut()}function h(){var b=gapi.client.request({path:"https://people.googleapis.com/v1/people/me",method:"GET"});b.then(function(b){j=i.currentUser.Ab.El,k=i.currentUser.Ab.Zi.access_token,a({method:"PATCH",url:"https://forge-api.herokuapp.com/users/login",data:{uid:j,token:k},success:function(a){l=a.result.displayName,console.log("Welcome, "+user.name+"!")},error:function(a){console.log(a)}})})}var i,j,k,l,m="AIzaSyCe__2EGSmwp0DR-qKGqpYwawfmRsTLBEs",n="730683845367-tjrrmvelul60250evn5i74uka4ustuln.apps.googleusercontent.com";gapi.load("client:auth2",d),$("#login").click(function(){f()}),$("#logout").click(function(){g()})}),angular.module("questCreator").controller("playCtrl",function(a,b,c){var d,e;a.emit("game joined"),a.off("old player found"),a.on("old player found",function(a){console.log("Found old player"),$("<canvas>").attr({id:a.id,class:"avatar",width:"100",height:"100"}).css({position:"absolute",left:a.x,top:a.y,border:"2px solid black",background:a.color}).appendTo("body")}),a.off("new player joining"),a.on("new player joining",function(b){var c={oldCharInfo:e,id:b.id};a.emit("send old player",c),$("<canvas>").attr({id:b.id,class:"avatar",width:"100",height:"100"}).css({position:"absolute",left:b.x,top:b.y,border:"2px solid black",background:b.color}).appendTo("body")}),a.off("updating player"),a.on("updating player",function(a){$("#"+a.id).css({left:a.x,top:a.y})}),a.off("player left"),a.on("player left",function(a){console.log("Player left!"),$("#"+a).remove()});var f;a.off("create character"),a.on("create character",function(b){d=b;var c=Math.round(Math.random()*window.innerWidth),g=Math.round(Math.random()*window.innerHeight),h=0,i=0,j=Math.round(255*Math.random()),k=Math.round(255*Math.random()),l=Math.round(255*Math.random()),m="rgb("+j+", "+k+","+l+")",n={id:b,x:c,y:g,speedX:h,speedY:i,color:m};e=n,a.emit("send new player",e),$("<canvas>").attr({id:b,class:"avatar",width:"100",height:"100"}).css({position:"absolute",left:c,top:g,border:"2px solid black",background:m}).appendTo("body"),f=setInterval(function(){c+=h,g+=i,$("#"+b).css({left:c,top:g}),charUpdate={id:b,x:c,y:g,speedX:h,speedY:i,color:m},a.emit("player update",charUpdate)},20),$("body").off().on("keydown",function(a){var b=a.keyCode;37===b?h+=-1:38===b?i+=-1:39===b?h+=1:40===b&&(i+=1)})}),c.$on("$destroy",function(){$(".avatar").remove(),a.emit("game left"),clearInterval(f)})}),angular.module("questCreator").controller("profileCtrl",function(a,b,c){});