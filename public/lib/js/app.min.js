!function(){"use strict";angular.module("questCreator",["ui.router","LocalStorageModule"]).config(function(a,b){b.otherwise("/"),a.state("main",{abstract:!0,url:"/",templateUrl:"./src/views/main.html",controller:"mainCtrl as main"}).state("main.landing",{url:"",templateUrl:"./src/views/landing.html",controller:"landingCtrl as landing"}).state("main.game",{url:"game/",templateUrl:"./src/views/game.html",controller:"gameCtrl as game"}).state("main.game.play",{url:"play/",templateUrl:"./src/views/game/play.html",controller:"playCtrl as play"}).state("main.game.editor",{url:"editor/",templateUrl:"./src/views/game/editor.html",controller:"editorCtrl as editor"}).state("main.game.editor.map",{url:"map/",templateUrl:"./src/views/game/editor/map.html",controller:"mapCtrl as map"}).state("main.game.editor.scene",{url:"scene/",templateUrl:"./src/views/game/editor/scene.html",controller:"sceneCtrl as scene"}).state("main.game.editor.bg",{url:"bg/",templateUrl:"./src/views/game/editor/bg.html",controller:"bgCtrl as bg"}).state("main.game.editor.obj",{url:"obj/",templateUrl:"./src/views/game/editor/obj.html",controller:"objCtrl as obj"}).state("main.game.editor.ent",{url:"ent/",templateUrl:"./src/views/game/editor/ent.html",controller:"entCtrl as ent"}).state("main.game.editor.scripts",{url:"scripts/",templateUrl:"./src/views/game/editor/scripts.html",controller:"scriptsCtrl as scripts"}).state("main.profile",{url:"profile/",templateUrl:"./src/views/profile.html",controller:"profileCtrl as profile"})})}(),angular.module("questCreator").service("socket",function(){var a=io();return{on:function(b,c){a.on(b,c)},emit:function(b,c){a.emit(b,c)},off:function(b,c){a.off(b,c)}}}),angular.module("questCreator").service("UserService",function(){function a(){gapi.client.setApiKey(j),gapi.auth2.init({client_id:k,scope:"profile"}).then(function(){h=gapi.auth2.getAuthInstance(),console.log("Session authorized"),h.isSignedIn.listen(b),b(h.isSignedIn.get())})}function b(a){a?($("#login").hide(),$("#logout").show(),console.log("Signed In!"),e()):($("#login").show(),$("#logout").hide(),console.log("Signed Out!"))}function c(){h.signIn({prompt:"login"})}function d(){h.signOut()}function e(){var a=gapi.client.request({path:"https://people.googleapis.com/v1/people/me",method:"GET"});a.then(function(a){i.uid=h.currentUser.Ab.El,i.token=h.currentUser.Ab.Zi.access_token,$.ajax({method:"PATCH",url:"https://forge-api.herokuapp.com/users/login",data:{uid:i.uid,token:i.token},success:function(a){console.log(a),i.username=a.username,i.id=a.id,$("#welcome").css("display","flex"),setTimeout(function(){$("#welcome").css("display","none")},2e3)},error:function(a){404===a.status?$("#register").css("display","flex"):0===a.status||alert("There was a problem logging in. Please try again")}})})}function f(a){$.ajax({method:"POST",url:"https://forge-api.herokuapp.com/users/create",data:{username:i.username,uid:i.uid,token:i.token},success:function(a){i.id=a.id,$("#register").css("display","none"),setTimeout(function(){$("#welcome").css("display","none")},2e3)},error:function(a){$("#register").css("display","none"),alert("There was a problem logging in. Please try again")}})}function g(){return i.id?$.ajax({method:"GET",url:"https://forge-api.herokuapp.com/games/user-games",data:{id:i.id},success:function(a){return a},error:function(a){alert("There was a problem loading the profile. Please try again.")}}):(alert("Please Login or Register"),void c())}var h,i={uid:null,token:null,username:null,picture:null,id:null},j="AIzaSyCe__2EGSmwp0DR-qKGqpYwawfmRsTLBEs",k="730683845367-tjrrmvelul60250evn5i74uka4ustuln.apps.googleusercontent.com";return gapi.load("client:auth2",a),{games:g,register:f,signOut:d,signIn:c}}),angular.module("questCreator").controller("chatCtrl",function(a,b){$("form").submit(function(){return console.log("Submitted!"),a.emit("chat message",$("#m").val()),$("#m").val(""),!1}),a.off("chat message"),a.on("chat message",function(a){$("#messages").append($("<li>").text(a))})}),angular.module("questCreator").controller("editorCtrl",function(a){this.backgroundName="Testing Background"}),angular.module("questCreator").controller("gameCtrl",function(a,b,c){}),angular.module("questCreator").controller("landingCtrl",function(a){}),angular.module("questCreator").controller("mainCtrl",function(a,b,c){this.goToUser=function(){var a=c.games();a.done(function(){b.go("main.profile")})},$("#login").click(function(){c.signIn()}),$("#logout").click(function(){c.signOut()})}),angular.module("questCreator").controller("playCtrl",function(a,b,c){function d(){i.clearRect(0,0,j,k),g.forEach(function(a){i.fillStyle=a.color,i.fillRect(a.x,a.y,100,100)})}var e,f,g=[],h=document.getElementById("play-canvas"),i=h.getContext("2d"),j=700,k=500;a.emit("game joined"),a.off("old player found"),a.on("old player found",function(a){console.log("Found old player"),g.push(a)}),a.off("new player joining"),a.on("new player joining",function(b){var c={oldCharInfo:f,id:b.id};g.push(b),a.emit("send old player",c)}),a.off("updating player"),a.on("updating player",function(a){}),a.off("player left"),a.on("player left",function(a){console.log("Player left!"),g.forEach(function(b,c){b.id===a})});var l;a.off("create character"),a.on("create character",function(b){e=b;var c=Math.round(Math.random()*j),h=Math.round(Math.random()*k),m=0,n=0,o=Math.round(255*Math.random()),p=Math.round(255*Math.random()),q=Math.round(255*Math.random()),r="rgb("+o+", "+p+","+q+")",s={id:b,x:c,y:h,speedX:m,speedY:n,color:r};g.push(s),f=s,a.emit("send new player",f),i.fillStyle=r,i.fillRect(c,h,100,100),l=setInterval(function(){c+=m,h+=n,charUpdate={id:b,x:c,y:h,speedX:m,speedY:n,color:r},g.forEach(function(a,c){a.id===b&&(g[c]=charUpdate)}),a.emit("player update",charUpdate),d()},20),$("body").off().on("keydown",function(a){var b=a.keyCode;37===b?m+=-1:38===b?n+=-1:39===b?m+=1:40===b&&(n+=1)})}),c.$on("$destroy",function(){a.emit("game left"),clearInterval(l)}),$(".chat-submit").submit(function(){return a.emit("chat message",$(".message").val()),$(".message").val(""),!1}),a.off("chat message"),a.on("chat message",function(a){$(".chat-messages").append($("<li>").text(a))})}),angular.module("questCreator").controller("profileCtrl",function(a,b,c){}),angular.module("questCreator").controller("sceneCtrl",function(a,b,c){function d(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.color=e,this.draw=function(){k.draw.fillStyle=this.color,window.innerWidth<=o?k.draw.fillRect(this.x*r,this.y*s,this.width,this.height):window.innerWidth<=p?k.draw.fillRect(this.x*q,this.y/q,this.width,this.height):k.draw.fillRect(this.x,this.y,this.width,this.height)}}function e(a){l===-1&&(l=setInterval(g,100))}function f(a){l!==-1&&(clearInterval(l),l=-1)}function g(){if(k.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},u&&v.background){var a=w,b=x,c=k.currentColor;if("mouse"===t){var e=m-k.canvasPos.x,f=n-k.canvasPos.y,g=!1;if(k.allBackgroundSquares.forEach(function(a){a.x===e&&a.y===f&&(g=!0)}),!g){var h=new d(m-k.canvasPos.x,n-k.canvasPos.y,a,b,c);h.draw(),k.allBackgroundSquares.push(h)}}else if("touch"===t){var h=new d(j.clientX-a/2-k.canvasPos.x,j.clientY-b/2-k.canvasPos.y,a,b,c);h.draw(),k.allBackgroundSquares.push(h)}u=!1}}function h(){for(var a=0;a<k.allBackgroundSquares.length;a++){var b=k.allBackgroundSquares[a];b.draw()}}var i,j,k=this,l=-1,m=0,n=0,o=850,p=1100,q=1.4,r=2.5,s=1.6,t="",u=!1,v={background:!0},w=10,x=10,y=[];this.speedRange=5,this.currentColor="#005500",this.myCanvas=document.getElementById("bg-canvas"),this.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},this.draw=this.myCanvas.getContext("2d"),this.backgroundName="Testing Background",this.allBackgroundSquares=[],$("#undo").click(function(){if(v.background&&k.allBackgroundSquares.length>0){var a=k.allBackgroundSquares.pop();y.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#redo").click(function(){if(v.background&&y.length>0){var a=y.pop();k.allBackgroundSquares.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#clear").click(function(){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[]}),$("#save").click(function(){console.log(k.allBackgroundSquares)}),$(k.myCanvas).on("mousedown",e),$(k.myCanvas).on("mouseup",f),$(k.myCanvas).on("mouseleave",f),$(k.myCanvas).on("mousemove",function(a){newMouseX=Math.round((a.clientX-w/2)/w)*w,newMouseY=Math.round((a.clientY-x/2)/x)*x,newMouseX===m&&newMouseY===n||(m=newMouseX,n=newMouseY,t="mouse",i=a,u=!0)}),$(k.myCanvas).on("touchstart",e),$(k.myCanvas).on("touchend",f),$(k.myCanvas).on("touchcancel",f),$(k.myCanvas).on("touchmove",function(a){t="touch",a.preventDefault(),j=a.touches[0],u=!0})});