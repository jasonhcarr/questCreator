!function(){"use strict";angular.module("questCreator",["ui.router","LocalStorageModule"]).config(function(a,b){b.otherwise("/"),a.state("main",{abstract:!0,url:"/",templateUrl:"./src/views/main.html",controller:"mainCtrl as main"}).state("main.landing",{url:"",templateUrl:"./src/views/landing.html",controller:"landingCtrl as landing"}).state("main.game",{url:"game",templateUrl:"./src/views/game.html",controller:"gameCtrl as game"}).state("main.game.detail",{url:"/detail",templateUrl:"./src/views/game/detail.html",controller:"detailCtrl as detail"}).state("main.game.play",{url:"/play",templateUrl:"./src/views/game/play.html",controller:"playCtrl as play"}).state("main.game.editor",{abstract:!0,url:"/editor",templateUrl:"./src/views/game/editor.html",controller:"editorCtrl as editor"}).state("main.game.editor.views",{url:"/",views:{palette:{templateUrl:"./src/views/game/editor/palette.html",controller:"paletteCtrl as palette"},maps:{templateUrl:"./src/views/game/editor/map.html",controller:"mapCtrl as map"},scenes:{templateUrl:"./src/views/game/editor/scene.html",controller:"sceneCtrl as scene"},backgrounds:{templateUrl:"./src/views/game/editor/bg.html",controller:"bgCtrl as bg"},objects:{templateUrl:"./src/views/game/editor/obj.html",controller:"objCtrl as obj"},entities:{templateUrl:"./src/views/game/editor/ent.html",controller:"entCtrl as ent"},scripts:{templateUrl:"./src/views/game/editor/scripts.html",controller:"scriptsCtrl as scripts"}}}).state("main.profile",{url:"profile",templateUrl:"./src/views/profile.html",controller:"profileCtrl as profile"})})}(),angular.module("questCreator").filter("capitalize",function(){return function(a){return a=a||"",a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}}),angular.module("questCreator").factory("Avatar",function(){function a(a){this.name=a.name,this.info=a.info,this.user_id=a.user_id,this.current=a.current,this.action="stand"}return a.prototype.updatePos=function(){this.info.pos.x+=this.info.speed.x,this.info.pos.y+=this.info.speed.y},a.prototype.stop=function(){this.action="stand",this.info.speed.x=0,this.info.speed.y=0},a.prototype.collide=function(a){switch(this.stop(),a){case"left":this.info.pos.x+=this.info.speed.mag;break;case"right":this.info.pos.x-=this.info.speed.mag;break;case"up":this.info.pos.y+=this.info.speed.mag;break;case"down":this.info.pos.y-=this.info.speed.mag}},a}),angular.module("questCreator").factory("Background",function(){function a(a){this.name=a.name,this.obj=a.obj,this.game_id=a.game_id}return a}),angular.module("questCreator").factory("Entity",function(){function a(a){this.name=a.name,this.obj=a.obj,this.game_id=a.game_id,this.action="walkRight"}return a.prototype.updatePos=function(){this.obj.pos.x+=this.obj.speed.x,this.obj.pos.y+=this.obj.speed.y},a.prototype.stop=function(){this.action="stand",this.obj.speed.x=0,this.obj.speed.y=0},a.prototype.collide=function(a){switch(this.stop(),a){case"left":this.obj.pos.x+=this.obj.speed.mag;break;case"right":this.obj.pos.x-=this.obj.speed.mag;break;case"up":this.obj.pos.y+=this.obj.speed.mag;break;case"down":this.obj.pos.y-=this.obj.speed.mag}},a}),angular.module("questCreator").factory("Game",function(){function a(a){this.name=a,this.maps=[],this.scenes=[],this.backgrounds=[],this.sceneObjects=[],this.entities=[]}return a}),angular.module("questCreator").factory("Map",function(){function a(a){this.name=a,this.scenes=[]}return a}),angular.module("questCreator").factory("PopupFactory",function(a){function b(b,c,d){var e=$("<popup>").attr({"popup-title":'"'+c+'"'}).append(b);e=a(e)(d),$(e).prependTo("body")}return{new:b}}),angular.module("questCreator").factory("Scene",function(){function a(a){this.name=a,this.backgrounds=[],this.sceneObjects=[],this.entities=[]}return a}),angular.module("questCreator").factory("SceneObject",function(){function a(a){this.name=a.name,this.obj=a.obj,this.game_id=a.game_id,this.action="none",this.allActions=[]}return a}),angular.module("questCreator").directive("popup",function(){return{scope:{title:"=popupTitle",kill:"@"},replace:!0,transclude:!0,link:function(a,b,c){a.kill=function(){$("#overlay").remove()}},templateUrl:"./src/views/popup.html",controller:function(a){a.killPopUp=function(){a.kill()}}}}),angular.module("questCreator").service("EditorService",function(a,b){function c(a){var b={name:a.toLowerCase()};return $.ajax({method:"GET",url:"https://forge-api.herokuapp.com/games/load",data:b,success:function(a){return a},error:function(a){alert("There was a problem loading this game")}})}function d(b){var c={user_id:a.get().id,token:a.get().token},d={game_id:b};return $.ajax({method:"GET",url:"https://forge-api.herokuapp.com/articles/game/all",headers:c,data:d,success:function(a){return a},error:function(a){console.log(a)}})}function e(c){var d={user_id:a.get().id,token:a.get().token},e={name:"Title Screen",pos:[0,0,0],background:null,objects:[],entities:[]},f={name:"Title Map",scenes:[[e]]},g={name:c,description:"",tags:[],info:{maps:[f]}};return $.ajax({method:"POST",url:"https://forge-api.herokuapp.com/games/create",data:JSON.stringify(g),headers:d,dataType:"json",contentType:"application/json",success:function(a){return g=a},error:function(a){alert("There was a problem creating this game. Please try again."),b.go("main.landing")}})}function f(b){var c={name:b.name,id:b.id,tags:b.tags,description:b.description,info:b.info,published:!0},d={user_id:a.get().id,token:a.get().token};return $.ajax({method:"PUT",url:"https://forge-api.herokuapp.com/games/update",headers:d,data:JSON.stringify(c),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function g(b,c){var d={user_id:a.get().id,token:a.get().token},e={image:[],collisionMap:[]},f={name:b,info:e,tags:[],published:!0,game_id:c};return $.ajax({method:"POST",url:"https://forge-api.herokuapp.com/backgrounds/create",headers:d,data:JSON.stringify(f),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function h(b,c){c.info.image=b;var d={user_id:a.get().id,token:a.get().token};return $.ajax({method:"PUT",url:"https://forge-api.herokuapp.com/backgrounds/update",headers:d,data:JSON.stringify(c),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function i(b,c){var d={user_id:a.get().id,token:a.get().token},e={pos:{x:350,y:250},image:[],collisionMap:[]},f={name:b,info:e,tags:[],published:!1,game_id:c};return $.ajax({method:"POST",url:"https://forge-api.herokuapp.com/obstacles/create",headers:d,data:JSON.stringify(f),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function j(b,c){c.info.image=b;var d={user_id:a.get().id,token:a.get().token};return $.ajax({method:"PUT",url:"https://forge-api.herokuapp.com/obstacles/update",headers:d,data:JSON.stringify(c),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function k(b,c){var d={user_id:a.get().id,token:a.get().token},e={pos:{x:350,y:250},image:[],collisionMap:[]},f={name:b,info:e,tags:[],published:!1,game_id:c};return $.ajax({method:"POST",url:"https://forge-api.herokuapp.com/entities/create",headers:d,data:JSON.stringify(f),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}function l(b,c){c.info.image=b;var d={user_id:a.get().id,token:a.get().token};return $.ajax({method:"PUT",url:"https://forge-api.herokuapp.com/entities/update",headers:d,data:JSON.stringify(c),dataType:"json",contentType:"application/json",success:function(a){return a},error:function(a){console.log(a)}})}return{getGame:c,getGameAssets:d,createGame:e,saveGame:f,createBackground:g,saveBackground:h,createObject:i,saveObject:j,createEntity:k,saveEntity:l}}),angular.module("questCreator").service("GameService",function(){function a(a){var b={name:a.toLowerCase()};return $.ajax({method:"GET",url:"https://forge-api.herokuapp.com/games/load",data:b,success:function(a){return a},error:function(a){alert("There was a problem loading this game")}})}function b(){return $.ajax({method:"GET",url:"https://forge-api.herokuapp.com/games/all",contentType:"application/json",success:function(a){return a},error:function(a){alert("There was a problem loading the games")}})}function c(){return e}function d(a){e=a}var e={};return{loadGame:a,getGameDetail:c,setGameDetail:d,getGames:b}}),angular.module("questCreator").service("PaletteService",function(a){function b(){return h}function c(){return g}function d(){$.ajax({method:"GET",url:"https://forge-api.herokuapp.com/articles/index",contentType:"application/json",success:function(a){return a},error:function(a){alert("There was a problem loading the assets")}})}function e(a){g=a;var b="";return"bg"===a?b="backgrounds/all":"obj"===a?b="obstacles/all":"ent"===a&&(b="entities/all"),$.ajax({method:"GET",url:"https://forge-api.herokuapp.com/"+b,headers:i,success:function(a){return console.log(a),h=a},error:function(a){alert("There was a problem loading the "+g+"s")}})}function f(a){return $.ajax({method:"GET",url:"https://forge-api.herokuapp.com/"+g+"/search",headers:i,data:a,success:function(a){return console.log(a),h=a},error:function(b){alert("There was a problem loading the "+g+"s matching your search for "+a)}})}var g="",h=null,i={user_id:a.get().id,token:a.get().token};return{getCurrent:b,getCurrentType:c,getAll:d,getByType:e,getByTag:f}}),angular.module("questCreator").service("PopupService",function(a,b,c){function d(a,d){d=d||c.$$childHead;var e=f+g[a].content,h=$("<ng-include>").attr("src","'"+e+"'");b.new(h,g[a].title,d)}function e(){$("#overlay").remove()}var f="./src/views/popups/",g={welcome:{title:"Welcome!",content:"welcome.html"},"user-register":{title:"Hey, you're new!",content:"user-register.html"},"edit-game":{title:"Awesome! Now you're editing:",content:"edit-game.html"},"create-game":{title:"Name your game:",content:"create-game.html"}};return{open:d,close:e}}),angular.module("questCreator").service("socket",function(){var a=io();return{on:function(b,c){a.on(b,c)},emit:function(b,c){a.emit(b,c)},off:function(b,c){a.off(b,c)}}}),angular.module("questCreator").service("UserService",function(a){function b(){return q}function c(a){q=a}function d(a){q.editGame=a}function e(){return q.editGame||null}function f(a){$.ajax({method:"DELETE",url:"https://forge-api.herokuapp.com/games/archive",data:{id:a},headers:{user_id:q.id,token:q.token},success:function(a){alert('Your game has been archived. If you ever want to see it again, click "Archived Games" below the list of your games. Carry on.')},error:function(a){alert("There was a problem archiving this game. Please try again.")}})}function g(){gapi.client.setApiKey(o),gapi.auth2.init({client_id:p,scope:"profile"}).then(function(){n=gapi.auth2.getAuthInstance(),console.log("Session authorized"),n.isSignedIn.listen(h),h(n.isSignedIn.get())})}function h(a){a?($("#login").hide(),$("#logout").show(),console.log("Signed In!"),k()):($("#login").show(),$("#logout").hide(),console.log("Signed Out!"))}function i(){n.signIn({prompt:"login"})}function j(){n.signOut()}function k(){var b=gapi.client.request({path:"https://people.googleapis.com/v1/people/me",method:"GET"});b.then(function(b){q.picture=b.result.photos[0].url,q.uid=n.currentUser.Ab.El,q.token=n.currentUser.Ab.Zi.access_token,$.ajax({method:"PATCH",url:"https://forge-api.herokuapp.com/users/login",data:{uid:q.uid,token:q.token},success:function(b){q.joined=b.created_at,q.username=b.username,q.id=b.id,a.open("welcome")},error:function(b){404===b.status?a.open("user-register"):0===b.status||(alert("There was a problem logging in. Please try again"),j())}})})}function l(b){q.username=b,$.ajax({method:"POST",url:"https://forge-api.herokuapp.com/users/create",data:{username:q.username,uid:q.uid,token:q.token},success:function(b){q.id=b.id,a.open("user-register")},error:function(a){alert("There was a problem logging in. Please try again"),j()}})}function m(){return q.id?$.ajax({method:"GET",url:"https://forge-api.herokuapp.com/games/user-games",headers:{user_id:q.id,token:q.token},success:function(a){return a},error:function(a){alert("There was a problem loading the profile. Please try again.")}}):(alert("Please Login or Register"),void i())}var n,o="AIzaSyCe__2EGSmwp0DR-qKGqpYwawfmRsTLBEs",p="730683845367-tjrrmvelul60250evn5i74uka4ustuln.apps.googleusercontent.com",q={uid:null,token:null,username:null,picture:null,id:null,games:null,joined:null,editGame:null};return gapi.load("client:auth2",g),{get:b,set:c,setGameEdit:d,getGameEdit:e,getUserGames:m,archive:f,register:l,signOut:j,signIn:i}}),angular.module("questCreator").controller("bgCtrl",function(a,b,c){function d(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.color=e,this.draw=function(){k.draw.fillStyle=this.color,window.innerWidth<=o?k.draw.fillRect(this.x*r,this.y*s,this.width,this.height):window.innerWidth<=p?k.draw.fillRect(this.x*q,this.y/q,this.width,this.height):k.draw.fillRect(this.x,this.y,this.width,this.height)}}function e(a){l===-1&&(l=setInterval(g,100))}function f(a){l!==-1&&(clearInterval(l),l=-1)}function g(){if(k.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},u&&v.background){var a=b.editor.currentPixelSize,c=b.editor.currentPixelSize,e=b.editor.currentColor;if("mouse"===t){var f=m-k.canvasPos.x,g=n-k.canvasPos.y,h=!1;if(k.allBackgroundSquares.forEach(function(a){a.x===f&&a.y===g&&(h=!0)}),!h){var i=new d(m-k.canvasPos.x,n-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}}else if("touch"===t){var i=new d(j.clientX-a/2-k.canvasPos.x,j.clientY-c/2-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}u=!1}}function h(){for(var a=0;a<k.allBackgroundSquares.length;a++){var b=k.allBackgroundSquares[a];b.draw()}}var i,j,k=this,l=-1,m=0,n=0,o=850,p=1100,q=1.4,r=2.5,s=1.6,t="",u=!1,v={background:!0},w=(b.editor.currentPixelSize,b.editor.currentPixelSize,[]);this.speedRange=5,this.currentColor=b.editor.currentColor,this.myCanvas=document.getElementById("bg-canvas"),this.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},this.draw=this.myCanvas.getContext("2d"),this.backgroundName="Testing Background",this.allBackgroundSquares=[],b.$on("redrawBackground",function(a,b){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[];k.allBackgroundSquares=b;for(var c=0;c<k.allBackgroundSquares.length;c++){var d=k.allBackgroundSquares[c];k.draw.fillStyle=d.color,k.draw.fillRect(d.x,d.y,d.width,d.height)}}),$("#undoBackground").click(function(){if(v.background&&k.allBackgroundSquares.length>0){var a=k.allBackgroundSquares.pop();w.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#redoBackground").click(function(){if(v.background&&w.length>0){var a=w.pop();k.allBackgroundSquares.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#clearBackground").click(function(){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[]}),$("#saveBackground").click(function(){c.saveBackground(k.allBackgroundSquares,b.editor.currentBackground).done(function(a){console.log(a)})}),$(k.myCanvas).on("mousedown",e),$(k.myCanvas).on("mouseup",f),$(k.myCanvas).on("mouseleave",f),$(k.myCanvas).on("mousemove",function(a){newMouseX=Math.round((a.clientX-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseY=Math.round((a.clientY-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseX===m&&newMouseY===n||(m=newMouseX,n=newMouseY,t="mouse",i=a,u=!0)}),$(k.myCanvas).on("touchstart",e),$(k.myCanvas).on("touchend",f),$(k.myCanvas).on("touchcancel",f),$(k.myCanvas).on("touchmove",function(a){t="touch",a.preventDefault(),j=a.touches[0],u=!0})}),angular.module("questCreator").controller("chatCtrl",function(a,b){$("form").submit(function(){return console.log("Submitted!"),a.emit("chat message",$("#m").val()),$("#m").val(""),!1}),a.off("chat message"),a.on("chat message",function(a){$("#messages").append($("<li>").text(a))})}),angular.module("questCreator").controller("detailCtrl",function(a,b){this.playGame=function(b){a.go("main.game.play")},this.game=b.getGameDetail(),this.players=[{name:"billy badass",score:72,timeToComplete:"00:45:06"},{name:"jaime presley",score:28,timeToComplete:"incomplete"},{name:"rob helms",score:56,timeToComplete:"02:32:06"},{name:"mr. toups",score:61,timeToComplete:"01:28:15"},{name:"nate",score:36,timeToComplete:"incomplete"},{name:"fitch",score:73,timeToComplete:"03:45:04"}]}),angular.module("questCreator").controller("editorCtrl",function(a,b,c,d,e,f){var g=this;this.gameInfo={},this.currentEditingGame={name:d.getGameEdit(),description:"",info:this.gameInfo,tags:[],published:!1},this.currentBackground=null,this.currentObject=null,this.currentEntity=null,this.currentScene=null,this.currentLargeView="background",this.currentSmallView="object",this.availableBackgrounds=[],this.availableObjects=[],this.availableEntities=[],this.selectedAnimation="Animations",this.currentColor="green",this.currentPixelSize=15,this.selectingAssets=!1,this.frameindex=0,this.dummyent={id:11,info:{pos:{x:350,y:250},animate:{walkleft:[{image:[{x:79.296875,y:43.203125,width:15,height:15,color:"brown"},{x:79.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"},{x:139.296875,y:73.203125,width:15,height:15,color:"brown"},{x:64.296875,y:88.203125,width:15,height:15,color:"brown"},{x:49.296875,y:73.203125,width:15,height:15,color:"brown"}],collisionMap:[]},{image:[{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"},{x:139.296875,y:73.203125,width:15,height:15,color:"brown"},{x:64.296875,y:88.203125,width:15,height:15,color:"brown"},{x:49.296875,y:73.203125,width:15,height:15,color:"brown"}],collisionMap:[]},{image:[{x:79.296875,y:43.203125,width:15,height:15,color:"brown"},{x:79.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"}],collisionMap:[]}],walkright:[{image:[{x:79.296875,y:43.203125,width:15,height:15,color:"brown"},{x:79.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"},{x:139.296875,y:73.203125,width:15,height:15,color:"brown"},{x:64.296875,y:88.203125,width:15,height:15,color:"brown"},{x:49.296875,y:73.203125,width:15,height:15,color:"brown"}],collisionMap:[]},{image:[{x:79.296875,y:43.203125,width:15,height:15,color:"brown"},{x:79.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"},{x:139.296875,y:73.203125,width:15,height:15,color:"brown"},{x:64.296875,y:88.203125,width:15,height:15,color:"brown"},{x:49.296875,y:73.203125,width:15,height:15,color:"brown"}],collisionMap:[]},{image:[{x:79.296875,y:43.203125,width:15,height:15,color:"brown"},{x:79.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:58.203125,width:15,height:15,color:"brown"},{x:94.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:58.203125,width:15,height:15,color:"brown"},{x:109.296875,y:43.203125,width:15,height:15,color:"brown"},{x:109.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:28.203125,width:15,height:15,color:"brown"},{x:79.296875,y:28.203125,width:15,height:15,color:"brown"},{x:94.296875,y:73.203125,width:15,height:15,color:"brown"},{x:94.296875,y:88.203125,width:15,height:15,color:"brown"},{x:94.296875,y:103.203125,width:15,height:15,color:"brown"},{x:94.296875,y:118.203125,width:15,height:15,color:"brown"},{x:94.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:133.203125,width:15,height:15,color:"brown"},{x:79.296875,y:148.203125,width:15,height:15,color:"brown"},{x:79.296875,y:163.203125,width:15,height:15,color:"brown"},{x:109.296875,y:133.203125,width:15,height:15,color:"brown"},{x:109.296875,y:148.203125,width:15,height:15,color:"brown"},{x:109.296875,y:163.203125,width:15,height:15,color:"brown"},{x:79.296875,y:88.203125,width:15,height:15,color:"brown"},{x:109.296875,y:88.203125,width:15,height:15,color:"brown"},{x:124.296875,y:88.203125,width:15,height:15,color:"brown"},{x:139.296875,y:73.203125,width:15,height:15,color:"brown"},{x:64.296875,y:88.203125,width:15,height:15,color:"brown"},{x:49.296875,y:73.203125,width:15,height:15,color:"brown"}],collisionMap:[]}]}},user_id:5,game_id:40,name:"ent 1",published:!1,tags:"[]",created_at:"2016-11-21T18:50:12.509Z",updated_at:"2016-11-21T18:52:59.961Z",$$hashKey:"object:105"},this.availableEntities.push(this.dummyent),this.goToPalette=function(a){g.selectingAssets=!0},null===this.currentEditingGame.name?(e.close(),e.open("create-game",a)):(e.close(),e.open("edit-game",a)),this.createNewGame=function(a){e.close(),c.createGame(a).done(function(a){console.log(a),g.currentEditingGame=a}),$(".create-game").hide(),d.setGameEdit(a)},this.editGame=function(){e.close(),c.getGame(g.currentEditingGame.name).done(function(b){g.currentEditingGame=b,console.log(g.currentEditingGame),c.getGameAssets(b.id).done(function(b){console.log(b),g.availableBackgrounds=b.availableBackgrounds,g.availableObjects=b.availableObstacles,g.availableEntities=b.availableEntities,a.$apply()})}),$(".edit-game").hide()},this.saveGame=function(){c.saveGame(g.currentEditingGame).done(function(a){console.log(a)})},this.publishGame=function(){g.currentEditingGame.published=!0,this.saveGame()},this.createBackground=function(){var b=prompt("Enter a name for the new background: "),d=g.currentEditingGame.id;c.createBackground(b,d).done(function(b){console.log(b),g.availableBackgrounds.push(b),g.currentBackground=b,a.$apply()})},this.editBackground=function(b){console.log(b),g.currentBackground=b,a.$broadcast("redrawBackground",b.info.image)},this.createObject=function(){var b=prompt("Enter a name for the new object: "),d=g.currentEditingGame.id;c.createObject(b,d).done(function(b){console.log(b),g.availableObjects.push(b),g.currentObject=b,g.currentSmallView="object",a.$apply()})},this.editObject=function(b){console.log(b),g.currentObject=b,g.currentSmallView="object",a.$broadcast("redrawObject",b.info.image)},this.createEntity=function(){var b=prompt("Enter a name for the new entity: "),d=g.currentEditingGame.id;c.createEntity(b,d).done(function(b){console.log("ent",b),g.availableEntities.push(b),g.currentEntity=b,g.currentSmallView="entity",a.$apply()})},this.editEntityFrame=function(b){g.currentEntity=b,g.currentSmallView="entity",console.log("ent",b),a.$broadcast("redrawEntity",b.info.animate[this.selectedAnimation][this.frameindex].image)},this.cancel=function(){e.close(),b.go("main.profile")},$(".asset").draggable({helper:"clone",start:function(a,b){$(b.helper).addClass("grabbed")},stop:function(a,b){$(b.helper).css({transition:"transform ease 100ms"}).removeClass("grabbed")}}),$("#bg-canvas").droppable({drop:function(a,b){console.log("ui",b);var c=$(b.draggable).clone();c.draggable(),$(this).append(c)}})}),angular.module("questCreator").controller("entCtrl",function(a,b,c){function d(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.color=e,this.draw=function(){k.draw.fillStyle=this.color,window.innerWidth<=o?k.draw.fillRect(this.x*r,this.y*s,this.width,this.height):window.innerWidth<=p?k.draw.fillRect(this.x*q,this.y/q,this.width,this.height):k.draw.fillRect(this.x,this.y,this.width,this.height)}}function e(a){l===-1&&(l=setInterval(g,100))}function f(a){l!==-1&&(clearInterval(l),l=-1)}function g(){if(k.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},u&&v.background){var a=b.editor.currentPixelSize,c=b.editor.currentPixelSize,e=b.editor.currentColor;if("mouse"===t){var f=m-k.canvasPos.x,g=n-k.canvasPos.y,h=!1;if(k.allBackgroundSquares.forEach(function(a){a.x===f&&a.y===g&&(h=!0)}),!h){var i=new d(m-k.canvasPos.x,n-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}}else if("touch"===t){var i=new d(j.clientX-a/2-k.canvasPos.x,j.clientY-c/2-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}u=!1}}function h(){for(var a=0;a<k.allBackgroundSquares.length;a++){var b=k.allBackgroundSquares[a];b.draw()}}var i,j,k=this,l=-1,m=0,n=0,o=850,p=1100,q=1.4,r=2.5,s=1.6,t="",u=!1,v={background:!0},w=(b.editor.currentPixelSize,b.editor.currentPixelSize,[]);this.speedRange=5,this.currentColor=b.editor.currentColor,this.myCanvas=document.getElementById("ent-canvas"),this.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},this.draw=this.myCanvas.getContext("2d"),this.allBackgroundSquares=[],b.$on("redrawEntity",function(a,b){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[];k.allBackgroundSquares=b;for(var c=0;c<k.allBackgroundSquares.length;c++){var d=k.allBackgroundSquares[c];k.draw.fillStyle=d.color,k.draw.fillRect(d.x,d.y,d.width,d.height)}}),$("#undoEntity").click(function(){if(v.background&&k.allBackgroundSquares.length>0){var a=k.allBackgroundSquares.pop();w.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#redoEntity").click(function(){if(v.background&&w.length>0){var a=w.pop();k.allBackgroundSquares.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#clearEntity").click(function(){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[]}),$("#saveEntity").click(function(){c.saveEntity(k.allBackgroundSquares,b.editor.currentEntity).done(function(a){console.log(a)})}),$(k.myCanvas).on("mousedown",e),$(k.myCanvas).on("mouseup",f),$(k.myCanvas).on("mouseleave",f),$(k.myCanvas).on("mousemove",function(a){
newMouseX=Math.round((a.clientX-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseY=Math.round((a.clientY-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseX===m&&newMouseY===n||(m=newMouseX,n=newMouseY,t="mouse",i=a,u=!0)}),$(k.myCanvas).on("touchstart",e),$(k.myCanvas).on("touchend",f),$(k.myCanvas).on("touchcancel",f),$(k.myCanvas).on("touchmove",function(a){t="touch",a.preventDefault(),j=a.touches[0],u=!0})}),angular.module("questCreator").controller("gameCtrl",function(a,b,c){}),angular.module("questCreator").controller("landingCtrl",function(a,b,c,d){this.allGames=d.getGames().done(function(a){b.$apply()}),b.createGame=function(){var d=c.get();d.id?(d.editGame=null,c.set(d),a.go("main.game.editor.views")):(alert("Please Sign In or Register."),b.signIn())},b.goToGameDetail=function(b){d.setGameDetail(b),a.go("main.game.detail")}}),angular.module("questCreator").controller("mainCtrl",function(a,b,c,d,e){this.goHome=function(){b.go("main.landing")},this.goToUser=function(){b.go("main.profile")},e.signIn=function(){c.signIn()},this.signOut=function(){c.signOut();var a={uid:null,token:null,username:null,picture:null,id:null,games:null,joined:null,editGame:null};c.set(a),b.go("main.landing")},this.register=function(a){c.register(a)},this.cancel=function(){$("#user-popup").css("display","none"),c.signOut()}}),angular.module("questCreator").controller("mapCtrl",function(a,b){this.width=1,this.height=1,this.createMap=function(){var a="new map",c="new scene";console.log("Creating a map!",a);var d={name:c,background:null,objects:[],entities:[]},e={name:a,scenes:[[d]]};b.editor.currentEditingGame.info.maps.push(e)},this.createMapRow=function(a){var c="new scene",d={name:c,background:null,objects:[],entities:[]};b.editor.currentEditingGame.info.maps[b.editor.currentEditingGame.info.maps.indexOf(a)].scenes.push([d])},this.createScene=function(a,c){var d="new scene",e={name:d,background:null,objects:[],entities:[]};console.log("Creating a scene!",a,c,d),b.editor.currentEditingGame.info.maps[b.editor.currentEditingGame.info.maps.indexOf(a)].scenes[c].push(e)},this.editScene=function(a){console.log(a),b.editor.currentScene=a,b.editor.currentLargeView="scene"}}),angular.module("questCreator").controller("objCtrl",function(a,b,c){function d(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.color=e,this.draw=function(){k.draw.fillStyle=this.color,window.innerWidth<=o?k.draw.fillRect(this.x*r,this.y*s,this.width,this.height):window.innerWidth<=p?k.draw.fillRect(this.x*q,this.y/q,this.width,this.height):k.draw.fillRect(this.x,this.y,this.width,this.height)}}function e(a){l===-1&&(l=setInterval(g,100))}function f(a){l!==-1&&(clearInterval(l),l=-1)}function g(){if(k.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},u&&v.background){var a=b.editor.currentPixelSize,c=b.editor.currentPixelSize,e=b.editor.currentColor;if("mouse"===t){var f=m-k.canvasPos.x,g=n-k.canvasPos.y,h=!1;if(k.allBackgroundSquares.forEach(function(a){a.x===f&&a.y===g&&(h=!0)}),!h){var i=new d(m-k.canvasPos.x,n-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}}else if("touch"===t){var i=new d(j.clientX-a/2-k.canvasPos.x,j.clientY-c/2-k.canvasPos.y,a,c,e);i.draw(),k.allBackgroundSquares.push(i)}u=!1}}function h(){for(var a=0;a<k.allBackgroundSquares.length;a++){var b=k.allBackgroundSquares[a];b.draw()}}var i,j,k=this,l=-1,m=0,n=0,o=850,p=1100,q=1.4,r=2.5,s=1.6,t="",u=!1,v={background:!0},w=(b.editor.currentPixelSize,b.editor.currentPixelSize,[]);this.speedRange=5,this.currentColor=b.editor.currentColor,this.myCanvas=document.getElementById("obj-canvas"),this.canvasPos={x:k.myCanvas.getBoundingClientRect().left,y:k.myCanvas.getBoundingClientRect().top},this.draw=this.myCanvas.getContext("2d"),this.allBackgroundSquares=[],b.$on("redrawObject",function(a,b){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[];k.allBackgroundSquares=b;for(var c=0;c<k.allBackgroundSquares.length;c++){var d=k.allBackgroundSquares[c];k.draw.fillStyle=d.color,k.draw.fillRect(d.x,d.y,d.width,d.height)}}),$("#undoObject").click(function(){if(v.background&&k.allBackgroundSquares.length>0){var a=k.allBackgroundSquares.pop();w.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#redoObject").click(function(){if(v.background&&w.length>0){var a=w.pop();k.allBackgroundSquares.push(a)}k.draw.clearRect(0,0,k.myCanvas.width,k.myCanvas.height),h()}),$("#clearObject").click(function(){canvasWidth=k.myCanvas.width,canvasHeight=k.myCanvas.height,k.draw.clearRect(0,0,canvasWidth,canvasHeight),k.allBackgroundSquares=[]}),$("#saveObject").click(function(){c.saveObject(k.allBackgroundSquares,b.editor.currentObject).done(function(a){console.log(a)})}),$(k.myCanvas).on("mousedown",e),$(k.myCanvas).on("mouseup",f),$(k.myCanvas).on("mouseleave",f),$(k.myCanvas).on("mousemove",function(a){newMouseX=Math.round((a.clientX-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseY=Math.round((a.clientY-b.editor.currentPixelSize/2)/b.editor.currentPixelSize)*b.editor.currentPixelSize,newMouseX===m&&newMouseY===n||(m=newMouseX,n=newMouseY,t="mouse",i=a,u=!0)}),$(k.myCanvas).on("touchstart",e),$(k.myCanvas).on("touchend",f),$(k.myCanvas).on("touchcancel",f),$(k.myCanvas).on("touchmove",function(a){t="touch",a.preventDefault(),j=a.touches[0],u=!0})}),angular.module("questCreator").controller("paletteCtrl",function(a,b){this.elements=[],this.currentType=a.getCurrentType(),this.allAssets=a.getAll(),this.assets=a.getCurrent(),this.searchByTag=function(b){a.getByTag(b)},this.goToEditor=function(){if(this.elements){var b=b("Do you wanna save the assets you chose before leaving this screen?");b&&a.saveToPalette(this.elements)}$state.go("main.game.editor")},this.addToPalette=function(a){this.elements.push(a)},this.saveElements=function(){this.elements=[]}}),angular.module("questCreator").controller("playCtrl",function(a,b,c,d,e,f,g,h,i){function j(){var a={name:"Avatar Test",info:{pos:{x:100,y:100},speed:{mag:3,x:0,y:0},animate:{walkLeft:[[{x:100,y:100,width:30,height:30,color:"blue"},{x:110,y:150,width:30,height:30,color:"green"}],[{x:110,y:100,width:30,height:30,color:"blue"},{x:100,y:150,width:30,height:30,color:"green"}]],walkRight:[[{x:150,y:100,width:30,height:30,color:"blue"},{x:140,y:150,width:30,height:30,color:"green"}],[{x:140,y:100,width:30,height:30,color:"blue"},{x:150,y:150,width:30,height:30,color:"green"}]],walkUp:[[{x:100,y:110,width:30,height:30,color:"red"},{x:150,y:100,width:30,height:30,color:"yellow"}],[{x:100,y:100,width:30,height:30,color:"red"},{x:150,y:110,width:30,height:30,color:"yellow"}]],walkDown:[[{x:100,y:140,width:30,height:30,color:"red"},{x:150,y:150,width:30,height:30,color:"yellow"}],[{x:100,y:150,width:30,height:30,color:"red"},{x:150,y:140,width:30,height:30,color:"yellow"}]],swimLeft:[[{x:100,y:100,width:30,height:30,color:"lightblue"},{x:150,y:150,width:30,height:30,color:"lightblue"}],[{x:100,y:100,width:30,height:30,color:"gray"},{x:150,y:150,width:30,height:30,color:"gray"}]],swimRight:[[{x:100,y:100,width:30,height:30,color:"lightblue"},{x:150,y:150,width:30,height:30,color:"lightblue"}],[{x:100,y:100,width:30,height:30,color:"gray"},{x:150,y:150,width:30,height:30,color:"gray"}]],swimUp:[[{x:100,y:100,width:30,height:30,color:"lightblue"},{x:150,y:150,width:30,height:30,color:"lightblue"}],[{x:100,y:100,width:30,height:30,color:"gray"},{x:150,y:150,width:30,height:30,color:"gray"}]],swimDown:[[{x:100,y:100,width:30,height:30,color:"lightblue"},{x:150,y:150,width:30,height:30,color:"lightblue"}],[{x:100,y:100,width:30,height:30,color:"gray"},{x:150,y:150,width:30,height:30,color:"gray"}]]},collisionMap:[{x:100,y:180,width:80,height:10,color:"gray"},{x:100,y:185,width:80,height:10,color:"gray"}]},current:!1},c={user_id:f.get().id,token:f.get().token};$.ajax({method:"POST",url:"https://forge-api.herokuapp.com/characters/create",headers:c,data:JSON.stringify(a),dataType:"json",contentType:"application/json",success:function(a){console.log(a),D=new b(a),console.log(D),D.info.currentFrame=D.info.animate.walkLeft[0],F=!0,setInterval(p,75)},error:function(a){console.log(a)}})}function k(a){a.includes("look")?A.phrase="This is a description of your current scene. I hope it's helpful.":A.phrase="I don't understand that.",$(".dialog").text(A.phrase).show(),A.show=!0,C=!0}function l(){var a=D.info.collisionMap[0].x,b=D.info.collisionMap[0].x+D.info.collisionMap[0].width,c=D.info.collisionMap[0].y,d=D.info.collisionMap[0].y+D.info.collisionMap[0].height;D.info.collisionMap.forEach(function(e){e.x<a&&(a=e.x),e.x+e.width>b&&(b=e.x+e.width),e.y<c&&(c=e.y),e.y+e.height>d&&(d=e.y+e.height)});var e={left:a+D.info.pos.x,right:b+D.info.pos.x,top:c+D.info.pos.y,bottom:d+D.info.pos.y,width:b-a,height:d-c};e.right<0?(u.currentScenePos[2]--,u.currentScenePos[2]<0&&(u.currentScenePos[2]=u.currentRow.length-1),n(),D.info.pos.x+=x):e.left>x?(u.currentScenePos[2]++,u.currentScenePos[2]>u.currentRow.length-1&&(u.currentScenePos[2]=0),n(),D.info.pos.x-=x):e.bottom<0?(u.currentScenePos[1]--,u.currentScenePos[1]>u.allRows.length-1&&(u.currentScenePos[1]=0),n(),D.info.pos.y+=y):e.top>y&&(u.currentScenePos[1]++,u.currentScenePos[1]>u.allRows.length-1&&(u.currentScenePos[1]=0),n(),D.info.pos.y-=y)}function m(){var a={found:!1,direction:"none",type:"none"};if(D.info.collisionMap.forEach(function(a){a.x+D.info.pos.x,a.x+a.width+D.info.pos.x,a.y+D.info.pos.y,a.y+a.height+D.info.pos.y}),a.found){switch(a.type){case"wall":D.collide(a.direction)}a={found:!1,direction:"none",type:"none"}}}function n(){u.currentMap=H[u.currentScenePos[0]],u.allRows=u.currentMap.scenes,u.currentRow=u.allRows[u.currentScenePos[1]],u.currentScene=u.currentRow[u.currentScenePos[2]],E=u.currentScene.background}function o(){D.updatePos()}function p(){"walkLeft"!==D.action&&"walkUp"!==D.action&&"walkRight"!==D.action&&"walkDown"!==D.action||(I>D.info.animate[D.action].length-1&&(I=0),D.info.currentFrame=D.info.animate[D.action][I],I++)}function q(){w.save(),w.translate(D.info.pos.x,D.info.pos.y),D.info.currentFrame.forEach(function(a){w.fillStyle=a.color,w.fillRect(a.x,a.y,a.width,a.height)}),w.globalAlpha=.2,D.info.collisionMap.forEach(function(a){w.fillStyle=a.color,w.fillRect(a.x,a.y,a.width,a.height)}),w.restore()}function r(){if(E){w.save(),w.globalCompositeOperation="destination-over";for(var a=E.info.image.length-1;a>=0;a--){var b=E.info.image[a];w.fillStyle=b.color,w.fillRect(b.x,b.y,b.width,b.height)}w.globalCompositeOperation="source-over",w.globalAlpha=.2,E.info.collisionMap.forEach(function(a){w.fillStyle=a.color,w.fillRect(a.x,a.y,a.width,a.height)}),w.restore()}else u.warning="This scene has no background yet!",setTimeout(function(){u.warning=""},2e3);i.$apply()}function s(){w.clearRect(0,0,x,y)}function t(){u.gameStarted&&(s(),F&&(l(),m(),o(),q()),r()),requestAnimationFrame(t)}var u=this,v=document.getElementById("play-canvas"),w=v.getContext("2d"),x=700,y=500;this.warning="";var z={show:!1,phrase:""},A={show:!1,phrase:""},B={show:!1,contents:""},C=!1,D=(new Date,null),E=null,F=!1;this.gameToPlay=g.getGameDetail().name;var G=null,H=null;this.currentMap=null,this.allRows=null,this.currentRow=null,this.currentScene=null,this.currentScenePos=[0,0,0],this.gameLoaded=!1,this.gameStarted=!1;g.loadGame(u.gameToPlay).done(function(a){u.gameLoaded=!0,G=a.info,H=G.maps,u.currentMap=H[0],u.allRows=u.currentMap.scenes,u.currentRow=u.allRows[0],u.currentScene=u.currentRow[0],E=u.currentScene.background,r(),i.$apply()});$("body").off("keyup").on("keyup",function(a){var b=a.which;37===b?(D.action="walkLeft"===D.action?"stand":"walkLeft",D.info.speed.x=D.info.speed.x===-1*D.info.speed.mag?0:-1*D.info.speed.mag,D.info.speed.y=0):38===b?(D.action="walkUp"===D.action?"stand":"walkUp",D.info.speed.x=0,D.info.speed.y=D.info.speed.y===-1*D.info.speed.mag?0:-1*D.info.speed.mag):39===b?(D.action="walkRight"===D.action?"stand":"walkRight",D.info.speed.x=D.info.speed.x===D.info.speed.mag?0:D.info.speed.mag,D.info.speed.y=0):40===b&&(D.action="walkDown"===D.action?"stand":"walkDown",D.info.speed.x=0,D.info.speed.y=D.info.speed.y===D.info.speed.mag?0:D.info.speed.mag)}),$("body").off("keypress").on("keypress",function(a){var b=a.which;if(z.show&&b>=32&&b<=220&&!A.show&&0===$(".active").length){C=!0;var c=String.fromCharCode(b);z.phrase+=c,$(".typing").text(z.phrase)}else if(13===b){if(z.show){z.show=!1,$(".typing").hide();var d=z.phrase;z.phrase="",k(d)}else A.show?(A.show=!1,$(".dialog").hide(),A.phrase=""):B.show;A.show||B.show||0!==$(".active").length||(C=!1)}else 32===b&&(z.show||(z.phrase=">",z.show=!0,$(".typing").text(z.phrase).show()))});var I=0;this.startGame=function(){u.currentScenePos=[1,0,0],n(),j(),u.gameStarted=!0},requestAnimationFrame(t)}),angular.module("questCreator").controller("profileCtrl",function(a,b,c,d){c.createGame=function(){c.user.editGame=null,d.set(c.user),b.go("main.game.editor.views")},c.editGame=function(a){c.user.editGame=a,d.set(c.user),b.go("main.game.editor.views")},c.archiveGame=function(a){var b=confirm("Are you sure you wanna archive '"+a.name+"'? That means no one will be able to play it and all player information will be lost. You will NOT be able to retrieve this later");b&&d.archive(a.id)},c.user=d.get(),c.getJoinedDate=function(a){return new Date(a)},d.getUserGames().done(function(a){c.games=a,c.$apply()})}),angular.module("questCreator").controller("sceneCtrl",function(a,b,c){var d=this;this.selecting={background:!1,object:!1,entity:!1},this.selectBackground=function(a){console.log(a),c.editor.currentScene.background=a,d.selecting.background=!1},this.selectObject=function(a){console.log(a),c.editor.currentScene.objects.push(a),d.selecting.object=!1},this.selectEntity=function(a){console.log(c.editor.currentScene.entities),c.editor.currentScene.entities.push(a),console.log(c.editor.currentScene.entities),d.selecting.entity=!1},this.saveScene=function(a){console.log("Turns out saving is unnecessary here. Here's the game as proof."),console.log(c.editor.currentEditingGame)}}),angular.module("questCreator").controller("scriptsCtrl",function(a){});var headerData,testData,testData,testData,testData;